#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "Checking remote status..."

# 1. Fetch the latest from remote
git fetch

# 2. Check if the current branch has an upstream
UPSTREAM=$(git rev-parse --abbrev-ref --symbolic-full-name @{u} 2>/dev/null)

if [ -n "$UPSTREAM" ]; then
  # 3. Count how many commits the remote is ahead
  BEHIND_COUNT=$(git rev-list HEAD..@{u} --count)

  if [ "$BEHIND_COUNT" -gt 0 ]; then
    echo "\033[0;31m[ERROR] Your branch is behind $UPSTREAM by $BEHIND_COUNT commit(s).\033[0m"
    echo "\033[0;33mPlease run 'git pull' before committing.\033[0m"
    exit 1
  fi
fi

# 4. Run lint-staged
pnpm lint-staged